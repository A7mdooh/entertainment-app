
<!DOCTYPE html>

<html dir="rtl" lang="ar">
<head>
<meta charset="utf-8"/>
<title>Ø§Ù„ØªØ­Ø¯ÙŠØ§Øª</title>
<link href="https://fonts.googleapis.com/css2?family=Cairo&amp;display=swap" rel="stylesheet"/>
<style>
    body {
      font-family: 'Cairo', sans-serif;
      background-color: #f0f4f8;
      margin: 0;
      padding: 20px;
      text-align: center;
    }
    .header {
      background-color: #00796B;
      color: white;
      padding: 1rem;
      border-radius: 8px;
      margin-bottom: 2rem;
    }
    select, button, input {
      padding: 10px;
      margin: 10px;
      font-size: 1rem;
      border-radius: 8px;
      border: 1px solid #ccc;
    }
    .teams {
      display: flex;
      flex-wrap: wrap;
      justify-content: center;
      gap: 20px;
      margin-top: 30px;
    }
    .team {
      background: white;
      padding: 20px;
      border-radius: 12px;
      width: 200px;
      box-shadow: 0 4px 8px rgba(0,0,0,0.1);
    }
    .team h3 {
      color: #00796B;
    }
    .score {
      font-size: 2rem;
      color: #00796B;
    }
    #multiTeamOptions {
      display: none;
    }
    #timerWrapper {
      position: relative;
      width: 120px;
      height: 120px;
      margin: 20px auto;
    }
    #timerTextSec {
      position: absolute;
      top: 50%;
      left: 50%;
      transform: translate(-50%, -50%);
      font-size: 1.8rem;
      font-weight: bold;
      color: #FF5722;
    }
    #timerWrapper.shake {
      animation: shake 0.5s infinite;
    }
    @keyframes shake {
      0% { transform: translate(0, 0); }
      25% { transform: translate(2px, 0); }
      50% { transform: translate(0, 2px); }
      75% { transform: translate(-2px, 0); }
      100% { transform: translate(0, -2px); }
    }
    #turnLabel {
      font-size: 1.5rem;
      margin: 20px;
      color: red;
    }
    #winnerDisplay {
      font-size: 2rem;
      margin-top: 20px;
      font-weight: bold;
      color: green;
    }
    #instructionModal {
      display: none;
      position: fixed;
      top: 0;
      right: 0;
      bottom: 0;
      left: 0;
      background: rgba(0,0,0,0.6);
      z-index: 10000;
      justify-content: center;
      align-items: center;
    }
    #instructionModal .content {
      background: white;
      padding: 30px;
      border-radius: 16px;
      max-width: 500px;
      width: 90%;
      text-align: center;
      box-shadow: 0 0 20px rgba(0,0,0,0.3);
    }
    #fireworks {
      display: none;
      position: fixed;
      top: 0; left: 0;
      width: 100vw; height: 100vh;
      background: url('../assets/media/sounds/firework.gif') center center no-repeat;
      background-size: cover;
      z-index: 9999;
    }
    #timeUpPopup {
      display: none;
      position: fixed;
      top: 30%;
      left: 50%;
      transform: translateX(-50%);
      background: white;
      padding: 30px;
      border-radius: 16px;
      box-shadow: 0 0 20px rgba(0,0,0,0.3);
      font-size: 1.5rem;
      color: #d32f2f;
      z-index: 10000;
    }
  </style>
</head>
<body style="padding-top: 60px;">
<div class="fixed-controls" style="position: fixed; top: 0; left: 0; right: 0; height: 50px; z-index: 10000;">
<button onclick="location.href='https://a7mdooh.github.io/entertainment-app/main.html'" style="position: absolute; top: 10px; left: 50%; transform: translateX(-50%); padding: 8px 16px; font-size: 1.2rem; border-radius: 8px; background-color: #607D8B; color: white; border: none;" title="Ø±Ø¬ÙˆØ¹">ğŸ“š</button>
<button onclick="toggleFullScreen()" style="position: absolute; top: 10px; right: 10px; font-size: 1.5rem; background: none; border: none; cursor: pointer;" title="Ù…Ù„Ø¡ Ø§Ù„Ø´Ø§Ø´Ø©">â›¶</button>
<button id="soundButton" onclick="toggleSound()" style="position: absolute; top: 10px; left: 10px; font-size: 1.5rem; background: none; border: none; cursor: pointer;" title="ÙƒØªÙ…/ØªØ´ØºÙŠÙ„ Ø§Ù„ØµÙˆØª">ğŸ”Š</button>
</div>
<div class="header">
<h1>ğŸ”¥ Ø§Ù„ØªØ­Ø¯ÙŠØ§Øª ğŸ”¥</h1>
</div>
<div>
<label>Ø§Ø®ØªØ± Ø§Ù„ØµÙ:</label>
<select id="classSelect"></select>
<label>Ù†ÙˆØ¹ Ø§Ù„ØªØ­Ø¯ÙŠ:</label>
<select id="mode" onchange="handleModeChange()">
<option value="random">Ø·Ø§Ù„Ø¨ Ø¶Ø¯ Ø·Ø§Ù„Ø¨ (Ø¹Ø´ÙˆØ§Ø¦ÙŠ)</option>
<option value="manual">Ø·Ø§Ù„Ø¨ Ø¶Ø¯ Ø·Ø§Ù„Ø¨ (Ø§Ø®ØªÙŠØ§Ø±ÙŠ)</option>
<option value="teams">ÙØ±ÙŠÙ‚ Ø¶Ø¯ ÙØ±ÙŠÙ‚</option>
<option value="multiTeams">ØªØ­Ø¯ÙŠ Ø¨ÙŠÙ† ÙØ±Ù‚ Ù…ØªØ¹Ø¯Ø¯Ø©</option>
</select>
<div id="manualSelection" style="display:none">
<label>Ø§Ø®ØªØ± Ø§Ù„Ø·Ø§Ù„Ø¨ Ø§Ù„Ø£ÙˆÙ„:</label>
<select id="student1Select"></select>
<label>Ø§Ø®ØªØ± Ø§Ù„Ø·Ø§Ù„Ø¨ Ø§Ù„Ø«Ø§Ù†ÙŠ:</label>
<select id="student2Select"></select>
</div>
<div id="multiTeamOptions">
<label>Ø¹Ø¯Ø¯ Ø§Ù„ÙØ±Ù‚:</label>
<select id="teamCountSelect">
<option value="3">3 ÙØ±Ù‚</option>
<option value="4">4 ÙØ±Ù‚</option>
<option value="5">5 ÙØ±Ù‚</option>
<option value="6">6 ÙØ±Ù‚</option>
<option value="7">7 ÙØ±Ù‚</option>
<option value="8">8 ÙØ±Ù‚</option>
</select>
</div>
<label>Ø§Ù„Ù…Ø¯Ø©:</label>
<select id="duration">
<option value="30">30 Ø«Ø§Ù†ÙŠØ©</option>
<option value="60">1 Ø¯Ù‚ÙŠÙ‚Ø©</option>
<option value="120">2 Ø¯Ù‚Ø§Ø¦Ù‚</option>
<option value="180">3 Ø¯Ù‚Ø§Ø¦Ù‚</option>
<option value="240">4 Ø¯Ù‚Ø§Ø¦Ù‚</option>
<option value="300">5 Ø¯Ù‚Ø§Ø¦Ù‚</option>
<option value="600">10 Ø¯Ù‚Ø§Ø¦Ù‚</option>
</select>
<button onclick="prepareChallenge()">Ø¨Ø¯Ø¡ Ø§Ù„ØªØ­Ø¯ÙŠ</button>
</div>
<div id="challengeArea" style="display:none">
<div id="turnLabel"></div>
<div id="timerWrapper">
<svg height="120" id="timerCircle" width="120">
<circle cx="60" cy="60" fill="none" r="50" stroke="#eee" stroke-width="10"></circle>
<circle cx="60" cy="60" fill="none" id="progress" r="50" stroke="#FF5722" stroke-dasharray="314" stroke-dashoffset="0" stroke-width="10" transform="rotate(-90 60 60)"></circle>
</svg>
<div id="timerTextSec">0s</div>
</div>
<div class="teams"></div>
<button onclick="nextTurn()">ğŸ” Ø§Ù„ØªØ§Ù„ÙŠ</button>
<button onclick="endChallenge()">ğŸ‰ Ø¥Ù†Ù‡Ø§Ø¡ Ø§Ù„ØªØ­Ø¯ÙŠ</button>
<div id="winnerDisplay"></div>
</div>
<!-- Ù†Ø§ÙØ°Ø© Ø§Ù„ØªØ¹Ù„ÙŠÙ…Ø§Øª Ø§Ù„Ù…Ù†Ø¨Ø«Ù‚Ø© -->
<div id="instructionModal" style="display:none; position:fixed; top:0; right:0; bottom:0; left:0; background:rgba(0,0,0,0.6); z-index:10000; justify-content:center; align-items:center;">
<div style="background:white; padding:30px; border-radius:16px; max-width:500px; width:90%; text-align:center; box-shadow:0 0 20px rgba(0,0,0,0.3);">
<h2>ğŸ“£ ØªØ¹Ù„ÙŠÙ…Ø§Øª Ø§Ù„ØªØ­Ø¯ÙŠ</h2>
<p id="instructionText" style="font-size:1.2rem; line-height:1.6;"></p>
<button onclick="closeInstructionModal()" style="margin-top:20px; background-color:#00796B; color:white; padding:10px 20px; border:none; border-radius:8px;">ÙÙ‡Ù…Øª âœ…</button>
</div>
</div>
<!-- Ù…Ø¤Ø«Ø±Ø§Øª Ø¨ØµØ±ÙŠØ© -->
<div id="fireworks"></div>
<div id="timeUpPopup">â° Ø§Ù†ØªÙ‡Ù‰ Ø§Ù„ÙˆÙ‚Øª!</div>
<!-- Ø§Ù„Ù…Ø¤Ø«Ø±Ø§Øª Ø§Ù„ØµÙˆØªÙŠØ© -->
<audio id="countdownSound" src="https://raw.githubusercontent.com/A7mdooh/entertainment-app/main/assets/media/sounds/countdown-beep.mp3"></audio>
<audio id="longBeepSound" src="https://raw.githubusercontent.com/A7mdooh/entertainment-app/main/assets/media/sounds/long-beep.mp3"></audio>
<audio id="winSound" src="https://raw.githubusercontent.com/A7mdooh/entertainment-app/main/assets/media/sounds/win.mp3"></audio>
<audio id="drawSound" src="https://raw.githubusercontent.com/A7mdooh/entertainment-app/main/assets/media/sounds/draw.mp3"></audio>
<script>
  let studentData = {}, currentList = [], timer, timeLeft = 0;
  let currentTurn = 1, score1 = 0, score2 = 0;
  let usedStudents = [];

  async function loadStudents() {
    const res = await fetch('/entertainment-app/data/studentData.json');
    studentData = await res.json();
    const classSelect = document.getElementById('classSelect');
    Object.keys(studentData).forEach(cls => {
      const option = document.createElement('option');
      option.value = cls;
      option.textContent = cls;
      classSelect.appendChild(option);
    });
    classSelect.addEventListener('change', () => {
      populateStudentSelectors(classSelect.value);
    });
    classSelect.selectedIndex = 0;
    populateStudentSelectors(classSelect.value);

    document.getElementById('student1Select').addEventListener('change', () => {
      populateStudentSelectors(classSelect.value);
    });

    document.getElementById('student2Select').addEventListener('change', () => {
      populateStudentSelectors(classSelect.value);
    });
  }

  function populateStudentSelectors(cls) {
    const s1 = document.getElementById('student1Select');
    const s2 = document.getElementById('student2Select');
    const students = studentData[cls] || [];
    const selected1 = s1.value;
    const selected2 = s2.value;

    s1.innerHTML = '';
    s2.innerHTML = '';

    students.forEach(stu => {
      if (stu !== selected2) {
        const opt1 = document.createElement('option');
        opt1.value = stu;
        opt1.textContent = stu;
        s1.appendChild(opt1);
      }
      if (stu !== selected1) {
        const opt2 = document.createElement('option');
        opt2.value = stu;
        opt2.textContent = stu;
        s2.appendChild(opt2);
      }
    });

    if (selected1 && [...s1.options].some(o => o.value === selected1)) s1.value = selected1;
    if (selected2 && [...s2.options].some(o => o.value === selected2)) s2.value = selected2;
  }

  function handleModeChange() {
    const mode = document.getElementById('mode').value;
    document.getElementById('manualSelection').style.display = (mode === 'manual') ? 'block' : 'none';
    document.getElementById('multiTeamOptions').style.display = (mode === 'multiTeams') ? 'block' : 'none';

    if (mode === 'manual') {
      const currentClass = document.getElementById('classSelect').value;
      populateStudentSelectors(currentClass);
    }
  }

  function showInstructionModal(mode) {
    const modal = document.getElementById('instructionModal');
    const text = document.getElementById('instructionText');
    let instructions = '';

    if (mode === 'random') {
      instructions = `Ø³ÙŠØªÙ… Ø§Ø®ØªÙŠØ§Ø± Ø·Ø§Ù„Ø¨ÙŠÙ† Ø¨Ø´ÙƒÙ„ Ø¹Ø´ÙˆØ§Ø¦ÙŠ Ù„Ù„ØªØ­Ø¯ÙŠ. ÙƒÙ„ Ø·Ø§Ù„Ø¨ Ù„Ù‡ Ø¯ÙˆØ± ÙˆØ²Ù…Ù† Ù…Ø­Ø¯Ø¯. Ø§Ù„Ù…Ø¹Ù„Ù… ÙŠØ³Ø¬Ù„ Ø§Ù„Ù†Ù‚Ø§Ø· ÙŠØ¯ÙˆÙŠÙ‹Ø§.`;
    } else if (mode === 'manual') {
      instructions = `ÙŠÙ…ÙƒÙ† Ø§Ø®ØªÙŠØ§Ø± Ø§Ù„Ø·Ø§Ù„Ø¨ÙŠÙ† ÙŠØ¯ÙˆÙŠÙ‹Ø§. ÙƒÙ„ Ø·Ø§Ù„Ø¨ Ù„Ù‡ ÙˆÙ‚Øª Ù…Ø­Ø¯Ø¯ Ù„Ù„Ø£Ø¯Ø§Ø¡. ÙŠØªÙ… ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ù†Ù‚Ø§Ø· ÙŠØ¯ÙˆÙŠÙ‹Ø§.`;
    } else if (mode === 'teams') {
      instructions = `ÙŠØªÙ… Ø§Ù„ØªØ­Ø¯ÙŠ Ø¨ÙŠÙ† ÙØ±ÙŠÙ‚ÙŠÙ†. ÙƒÙ„ ÙØ±ÙŠÙ‚ ÙŠÙ…ÙƒÙ†Ù‡ ÙƒØ³Ø¨ Ø£Ùˆ Ø®Ø³Ø§Ø±Ø© Ù†Ù‚Ø§Ø·. Ø§Ù„Ù‡Ø¯Ù Ù‡Ùˆ Ø§Ù„ØªÙØ§Ø¹Ù„ Ø§Ù„Ø¬Ù…Ø§Ø¹ÙŠ.`;
    } else if (mode === 'multiTeams') {
      instructions = `Ø³ÙŠØªÙ… Ø¥Ù†Ø´Ø§Ø¡ Ø¹Ø¯Ø© ÙØ±Ù‚ (Ù…Ù† 3 Ø¥Ù„Ù‰ 8) Ø­Ø³Ø¨ Ø§Ø®ØªÙŠØ§Ø±Ùƒ. ÙƒÙ„ ÙØ±ÙŠÙ‚ Ù„Ù‡ Ø¯ÙˆØ±Ù‡ ÙˆÙ†Ù‚Ø§Ø·Ù‡ Ø§Ù„Ø®Ø§ØµØ©.`;
    }

    text.textContent = instructions;
    modal.style.display = 'flex';
  }

  function showCurrentModeInstructions() {
    const mode = document.getElementById('mode').value;
    showInstructionModal(mode);
  }

  function closeInstructionModal() {
    document.getElementById('instructionModal').style.display = 'none';
    prepareChallengeContinue();
  }

  function prepareChallenge() {
    const mode = document.getElementById('mode').value;
    showInstructionModal(mode);
  }

  function prepareChallengeContinue() {
    const cls = document.getElementById('classSelect').value;
    const mode = document.getElementById('mode').value;
    timeLeft = parseInt(document.getElementById('duration').value);
    currentList = [...(studentData[cls] || [])];

    if (mode === 'multiTeams') {
      const teamCount = parseInt(document.getElementById('teamCountSelect').value);
      const container = document.querySelector('.teams');
      container.innerHTML = '';

      for (let i = 1; i <= teamCount; i++) {
        const div = document.createElement('div');
        div.className = 'team';
        div.innerHTML = `
          <h3 id="name${i}">ÙØ±ÙŠÙ‚ ${i}</h3>
          <div class="score" id="score${i}">0</div>
          <button onclick="adjustScore(${i}, 1)">â•</button>
          <button onclick="adjustScore(${i}, -1)">â–</button>
        `;
        container.appendChild(div);
        window[`score${i}`] = 0;
      }

      currentTurn = 1;
      document.getElementById('challengeArea').style.display = 'block';
      document.getElementById('winnerDisplay').textContent = '';
      nextTurn();
      return;
    }

    if (currentList.length < 2) return alert('ÙŠØ¬Ø¨ Ø§Ø®ØªÙŠØ§Ø± ØµÙ Ø¨Ù‡ Ø·Ù„Ø§Ø¨.');

    let name1 = 'ÙØ±ÙŠÙ‚ 1', name2 = 'ÙØ±ÙŠÙ‚ 2';

    if (mode === 'random') {
      const remaining = currentList.filter(s => !usedStudents.includes(s));
      if (remaining.length < 2) return alert('ØªÙ… Ø§Ø³ØªØ®Ø¯Ø§Ù… Ø¬Ù…ÙŠØ¹ Ø§Ù„Ø·Ù„Ø§Ø¨.');
      const shuffled = [...remaining].sort(() => 0.5 - Math.random());
      name1 = shuffled[0];
      name2 = shuffled[1];
      usedStudents.push(shuffled[0], shuffled[1]);
    } else if (mode === 'manual') {
      name1 = document.getElementById('student1Select').value;
      name2 = document.getElementById('student2Select').value;
      if (name1 === name2) return alert('Ø§Ø®ØªØ± Ø·Ø§Ù„Ø¨ÙŠÙ† Ù…Ø®ØªÙ„ÙÙŠÙ†.');
    }

    document.querySelector('.teams').innerHTML = `
      <div class="team">
        <h3 id="name1">${name1}</h3>
        <div class="score" id="score1">0</div>
        <button onclick="adjustScore(1, 1)">â•</button>
        <button onclick="adjustScore(1, -1)">â–</button>
      </div>
      <div class="team">
        <h3 id="name2">${name2}</h3>
        <div class="score" id="score2">0</div>
        <button onclick="adjustScore(2, 1)">â•</button>
        <button onclick="adjustScore(2, -1)">â–</button>
      </div>
    `;

    score1 = 0;
    score2 = 0;
    currentTurn = 1;

    document.getElementById('challengeArea').style.display = 'block';
    document.getElementById('winnerDisplay').textContent = '';
    nextTurn();
  }

  function updateTimer() {
    const secText = document.getElementById('timerTextSec');
    const circle = document.getElementById('progress');
    const wrapper = document.getElementById('timerWrapper');

    const total = parseInt(document.getElementById('duration').value);
    const percent = timeLeft / total;
    const offset = 314 * (1 - percent);

    circle.style.strokeDashoffset = offset;
    secText.textContent = `${timeLeft}s`;

    if (timeLeft <= 10 && timeLeft > 0) {
      wrapper.classList.add('shake');
      document.getElementById('countdownSound').play();
    } else {
      wrapper.classList.remove('shake');
    }
  }

  function startTimer() {
    updateTimer();
    timer = setInterval(() => {
      timeLeft--;
      updateTimer();
      if (timeLeft <= 0) {
        clearInterval(timer);
        document.getElementById('longBeepSound').play();
        document.getElementById('turnLabel').textContent += ' - Ø§Ù†ØªÙ‡Ù‰ Ø§Ù„Ø¯ÙˆØ±';
        showTimeUpPopup();
      }
    }, 1000);
  }

  function showTimeUpPopup() {
    const popup = document.getElementById('timeUpPopup');
    popup.style.display = 'block';
    popup.style.opacity = 1;
    setTimeout(() => {
      popup.style.transition = 'opacity 1.5s';
      popup.style.opacity = 0;
      setTimeout(() => {
        popup.style.display = 'none';
        nextTurn();
      }, 1500);
    }, 2000);
  }

  function nextTurn() {
    clearInterval(timer);
    const mode = document.getElementById('mode').value;

    if (mode === 'multiTeams') {
      const count = parseInt(document.getElementById('teamCountSelect').value);
      document.getElementById('turnLabel').textContent = `Ø§Ù„Ø¯ÙˆØ± Ø¹Ù„Ù‰: ÙØ±ÙŠÙ‚ ${currentTurn}`;
      timeLeft = parseInt(document.getElementById('duration').value);
      startTimer();
      currentTurn = currentTurn >= count ? 1 : currentTurn + 1;
      return;
    }

    document.getElementById('turnLabel').textContent = `Ø§Ù„Ø¯ÙˆØ± Ø¹Ù„Ù‰: ${currentTurn === 1 ? document.getElementById('name1').textContent : document.getElementById('name2').textContent}`;
    timeLeft = parseInt(document.getElementById('duration').value);
    startTimer();
    currentTurn = currentTurn === 1 ? 2 : 1;
  }

  function adjustScore(team, val) {
    const scoreElement = document.getElementById(`score${team}`);
    let score = parseInt(scoreElement.textContent) + val;
    score = Math.max(0, score);
    scoreElement.textContent = score;
  }

  function endChallenge() {
    clearInterval(timer);
    const mode = document.getElementById('mode').value;

    if (mode === 'multiTeams') {
      const count = parseInt(document.getElementById('teamCountSelect').value);
      let maxScore = -1;
      let winners = [];

      for (let i = 1; i <= count; i++) {
        const score = parseInt(document.getElementById(`score${i}`).textContent);
        if (score > maxScore) {
          maxScore = score;
          winners = [`ÙØ±ÙŠÙ‚ ${i}`];
        } else if (score === maxScore) {
          winners.push(`ÙØ±ÙŠÙ‚ ${i}`);
        }
      }

      const result = winners.length > 1 ? `ØªØ¹Ø§Ø¯Ù„ Ø¨ÙŠÙ†: ${winners.join(' Ùˆ ')}` : `ğŸ‰ Ø§Ù„ÙØ§Ø¦Ø²: ${winners[0]}`;
      document.getElementById('winnerDisplay').textContent = result;
      document.getElementById('winSound').play();
      document.getElementById('fireworks').style.display = 'block';
      setTimeout(() => {
        document.getElementById('fireworks').style.display = 'none';
      }, 4000);
      return;
    }

    // Ù„Ù„Ø£Ù†ÙˆØ§Ø¹ Ø§Ù„Ø£Ø®Ø±Ù‰
    const name1 = document.getElementById('name1').textContent;
    const name2 = document.getElementById('name2').textContent;
    const score1 = parseInt(document.getElementById('score1').textContent);
    const score2 = parseInt(document.getElementById('score2').textContent);
    let winner;

    if (score1 > score2) {
      winner = name1;
      document.getElementById('winSound').play();
    } else if (score2 > score1) {
      winner = name2;
      document.getElementById('winSound').play();
    } else {
      winner = 'ØªØ¹Ø§Ø¯Ù„';
      document.getElementById('drawSound').play();
    }

    document.getElementById('winnerDisplay').textContent = `ğŸ‰ Ø§Ù„ÙØ§Ø¦Ø²: ${winner}`;
    document.getElementById('fireworks').style.display = 'block';
    setTimeout(() => {
      document.getElementById('fireworks').style.display = 'none';
    }, 4000);
  }

  window.onload = loadStudents;

function goBack() {
  window.history.back();
}

function toggleFullScreen() {
  if (!document.fullscreenElement) {
    document.documentElement.requestFullscreen();
  } else {
    if (document.exitFullscreen) {
      document.exitFullscreen();
    }
  }
}

let isMuted = false;
function toggleSound() {
  isMuted = !isMuted;
  const soundButton = document.getElementById('soundButton');
  const audios = document.querySelectorAll('audio');
  audios.forEach(audio => {
    audio.muted = isMuted;
  });
  soundButton.textContent = isMuted ? 'ğŸ”‡' : 'ğŸ”Š';
}
</script>
</body>
</html>
