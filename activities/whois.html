<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>من هو؟ ❓</title>
  <link href="https://fonts.googleapis.com/css2?family=Cairo&display=swap" rel="stylesheet">
  <script src="https://cdn.jsdelivr.net/npm/canvas-confetti@1.5.1/dist/confetti.browser.min.js"></script>
  <style>
    body {
      font-family: 'Cairo', sans-serif;
      background: #f0f4f8;
      margin: 0;
      padding: 20px;
      text-align: center;
    }
    .header {
      background: #00796B;
      color: white;
      padding: 1rem;
      border-radius: 8px;
      margin-bottom: 2rem;
    }
    .hint-box {
      background: #fff;
      padding: 20px;
      border-radius: 12px;
      box-shadow: 0 4px 12px rgba(0,0,0,0.1);
      margin-bottom: 20px;
      font-size: 1.5rem;
      color: #333;
    }
    .options {
      display: flex;
      flex-wrap: wrap;
      justify-content: center;
      gap: 15px;
    }
    .option {
      background: #fff;
      padding: 15px 25px;
      border: 2px solid #00796B;
      border-radius: 8px;
      font-size: 1.2rem;
      cursor: pointer;
      transition: 0.3s;
    }
    .option:hover {
      background: #00796B;
      color: white;
    }
    .score-board {
      margin-top: 20px;
      font-size: 1.2rem;
      color: #00796B;
    }
    #feedback {
      margin-top: 15px;
      font-size: 1.5rem;
      font-weight: bold;
    }
    .leaderboard {
      margin-top: 30px;
      font-size: 1.2rem;
      color: #555;
    }
    .timer {
      font-size: 1.2rem;
      margin-top: 10px;
      color: #c62828;
    }
    #teamSelect {
      margin-bottom: 20px;
      font-size: 1rem;
      padding: 10px;
    }
    .student-card {
      display: inline-block;
      padding: 10px 20px;
      margin: 8px;
      border: 2px solid #00796B;
      border-radius: 10px;
      cursor: pointer;
      transition: 0.3s;
    }
    .student-card.selected {
      background-color: #00796B;
      color: white;
    }
    .student-card:hover {
      background-color: #e0f2f1;
    }
  </style>
</head>
<body>
  <div class="header">
    <h1>❓ نشاط: من هو؟</h1>
    <p>اختر الصف ونوع النمط لبدء التحدي</p>
    <select id="classSelect"></select>
    <select id="modeSelect">
      <option value="random">فردي عشوائي</option>
      <option value="manual">فردي انتقائي</option>
    </select>
    <button onclick="startGame()">ابدأ</button>
  </div>

  <select id="teamSelect">
    <option value="teamA">🔵 فريق أ</option>
    <option value="teamB">🟢 فريق ب</option>
  </select>

  <div class="hint-box" id="hint">...</div>
  <div class="options" id="options"></div>
  <div id="feedback"></div>
  <div class="timer" id="timer"></div>
  <div class="score-board">
    نقاط فريق أ: <span id="scoreA">0</span> | نقاط فريق ب: <span id="scoreB">0</span>
  </div>
  <div class="leaderboard" id="leaderboard"></div>

  <script>
    let allStudents = [], selectedStudents = [], questions = [];
    let currentIndex = 0;
    let scoreA = 0, scoreB = 0;
    let timerInterval, timeLeft = 15;

    async function loadStudentData() {
      const res = await fetch('https://raw.githubusercontent.com/A7mdooh/entertainment-app/main/data/studentData.json');
      const data = await res.json();
      const classSelect = document.getElementById("classSelect");
      classSelect.innerHTML = "<option disabled selected>اختر الصف</option>";
      for (const cls in data) {
        const opt = document.createElement("option");
        opt.value = cls;
        opt.textContent = `الصف ${cls}`;
        classSelect.appendChild(opt);
      }
      return data;
    }

    async function startGame() {
      const data = await loadStudentData();
      const selectedClass = document.getElementById("classSelect").value;
      const mode = document.getElementById("modeSelect").value;
      if (!selectedClass || !mode) return alert("يرجى اختيار الصف والنمط");

      allStudents = data[selectedClass];
      if (mode === 'manual') {
        const selectionArea = document.createElement("div");
        selectionArea.id = "manualSelection";
        selectionArea.style.marginTop = "20px";
        selectionArea.innerHTML = '<h3>اختر الطلاب للمشاركة:</h3>';
        allStudents.forEach(name => {
          const card = document.createElement("div");
          card.textContent = name;
          card.className = "student-card";
          card.onclick = () => {
            card.classList.toggle("selected");
          };
          selectionArea.appendChild(card);
        });
        const confirmBtn = document.createElement("button");
        confirmBtn.textContent = "بدء النشاط";
        confirmBtn.style.display = "block";
        confirmBtn.style.marginTop = "15px";
        confirmBtn.onclick = () => {
          selectedStudents = Array.from(selectionArea.querySelectorAll(".selected")).map(d => d.textContent);
          if (selectedStudents.length === 0) return alert("يرجى اختيار طالب واحد على الأقل");
          document.body.removeChild(selectionArea);
          generateQuestions();
        };
        selectionArea.appendChild(confirmBtn);
        document.body.appendChild(selectionArea);
        return;
      } else {
        selectedStudents = [...allStudents];
        generateQuestions();
      }
    }

    function generateQuestions() {
      const hintsBank = [
        "يساعد زملاءه دائمًا.", "يشارك في جميع الأنشطة الصفية.", "يحب القراءة كثيرًا.",
        "يجلس في الصف الأول.", "يرتدي نظارات جميلة.", "يعشق مادة العلوم.",
        "هادئ ومؤدب.", "يقود فريقه دومًا.", "يمتلك خطًا جميلًا.",
        "يشارك في الإذاعة المدرسية.", "يتفاعل كثيرًا مع المعلم.",
        "يشجع ريال مدريد ويظن نفسه فينيسيوس!",
        "يرتدي قميص باريس سان جيرمان في كل حصة!",
        "كل تمريراته دقيقة كأنه دي بروين!",
        "يحب الرياضة، خاصة الجري نحو الفسحة!",
        "يفتتح كل صباح بتحليل مباريات الأمس!",
        "إذا سمع كلمة فسحة، يتحول إلى عدّاء محترف!",
        "يسأل أسئلة لا علاقة لها بالدرس ولكنها ممتعة!",
        "دائمًا مبتسم.", "يطرح أسئلة ذكية دائمًا."
      ];

      const shuffled = [...selectedStudents].sort(() => 0.5 - Math.random()).slice(0, 10);
      questions = shuffled.map(name => {
        const randomOptions = allStudents.filter(n => n !== name).sort(() => 0.5 - Math.random()).slice(0, 3);
        const options = [...randomOptions, name].sort(() => 0.5 - Math.random());
        const hint = hintsBank[Math.floor(Math.random() * hintsBank.length)];
        return { hint, answer: name, options };
      });

      loadQuestion();
    }

    function loadQuestion() {
      timeLeft = 15;
      startTimer();
      const q = questions[currentIndex];
      document.getElementById("hint").textContent = q.hint;
      const optionsBox = document.getElementById("options");
      optionsBox.innerHTML = '';
      q.options.forEach(opt => {
        const div = document.createElement("div");
        div.className = 'option';
        div.textContent = opt;
        div.onclick = () => selectAnswer(opt);
        optionsBox.appendChild(div);
      });
    }

    function startTimer() {
      clearInterval(timerInterval);
      document.getElementById("timer").textContent = `⏳ الوقت المتبقي: ${timeLeft} ثانية`;
      timerInterval = setInterval(() => {
        timeLeft--;
        document.getElementById("timer").textContent = `⏳ الوقت المتبقي: ${timeLeft} ثانية`;
        if (timeLeft <= 0) {
          clearInterval(timerInterval);
          selectAnswer(null);
        }
      }, 1000);
    }

    function selectAnswer(choice) {
      clearInterval(timerInterval);
      const correct = questions[currentIndex].answer;
      const feedback = document.getElementById("feedback");
      const team = document.getElementById("teamSelect").value;

      if (choice === correct) {
        feedback.textContent = "إجابة صحيحة! ✨";
        feedback.style.color = '#388e3c';
        confetti({ particleCount: 100, spread: 90 });
        if (team === 'teamA') {
          scoreA++; document.getElementById("scoreA").textContent = scoreA;
        } else {
          scoreB++; document.getElementById("scoreB").textContent = scoreB;
        }
      } else {
        feedback.textContent = "خطأ! الإجابة الصحيحة كانت: " + correct;
        feedback.style.color = '#c62828';
      }

      setTimeout(() => {
        feedback.textContent = "";
        currentIndex++;
        if (currentIndex < questions.length) {
          loadQuestion();
        } else {
          document.getElementById("hint").textContent = "✅ انتهى النشاط!";
          document.getElementById("options").innerHTML = "";
          document.getElementById("timer").textContent = "";
          document.getElementById("leaderboard").innerHTML =
            `<strong>النتيجة النهائية:</strong><br>🔵 فريق أ: ${scoreA} نقطة<br>🟢 فريق ب: ${scoreB} نقطة`;
        }
      }, 2000);
    }
  </script>
</body>
</html>
