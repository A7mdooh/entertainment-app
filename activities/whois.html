<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Ù…Ù† Ù‡ÙˆØŸ â“</title>
  <link href="https://fonts.googleapis.com/css2?family=Cairo&display=swap" rel="stylesheet">
  <script src="https://cdn.jsdelivr.net/npm/canvas-confetti@1.5.1/dist/confetti.browser.min.js"></script>
  <style>
    body {
      font-family: 'Cairo', sans-serif;
      background: #f0f4f8;
      margin: 0;
      padding: 20px;
      text-align: center;
    }
    .header {
      background: #00796B;
      color: white;
      padding: 1rem;
      border-radius: 8px;
      margin-bottom: 2rem;
    }
    .hint-box {
      background: #fff;
      padding: 20px;
      border-radius: 12px;
      box-shadow: 0 4px 12px rgba(0,0,0,0.1);
      margin-bottom: 20px;
      font-size: 1.5rem;
      color: #333;
    }
    .options {
      display: flex;
      flex-wrap: wrap;
      justify-content: center;
      gap: 15px;
    }
    .option {
      background: #fff;
      padding: 15px 25px;
      border: 2px solid #00796B;
      border-radius: 8px;
      font-size: 1.2rem;
      cursor: pointer;
      transition: 0.3s;
    }
    .option:hover {
      background: #00796B;
      color: white;
    }
    .score-board {
      margin-top: 20px;
      font-size: 1.2rem;
      color: #00796B;
    }
    #feedback {
      margin-top: 15px;
      font-size: 1.5rem;
      font-weight: bold;
    }
    .leaderboard {
      margin-top: 30px;
      font-size: 1.2rem;
      color: #555;
    }
    .timer {
      font-size: 1.2rem;
      margin-top: 10px;
      color: #c62828;
    }
    #teamSelect {
      margin-bottom: 20px;
      font-size: 1rem;
      padding: 10px;
    }
    .student-card {
      display: inline-block;
      padding: 10px 20px;
      margin: 8px;
      border: 2px solid #00796B;
      border-radius: 10px;
      cursor: pointer;
      transition: 0.3s;
    }
    .student-card.selected {
      background-color: #00796B;
      color: white;
    }
    .student-card:hover {
      background-color: #e0f2f1;
    }
  </style>
</head>
<body>
  <div class="header">
    <h1>â“ Ù†Ø´Ø§Ø·: Ù…Ù† Ù‡ÙˆØŸ</h1>
    <p>Ø§Ø®ØªØ± Ø§Ù„ØµÙ ÙˆÙ†ÙˆØ¹ Ø§Ù„Ù†Ù…Ø· Ù„Ø¨Ø¯Ø¡ Ø§Ù„ØªØ­Ø¯ÙŠ</p>
    <select id="classSelect"></select>
    <select id="modeSelect">
      <option value="random">ÙØ±Ø¯ÙŠ Ø¹Ø´ÙˆØ§Ø¦ÙŠ</option>
      <option value="manual">ÙØ±Ø¯ÙŠ Ø§Ù†ØªÙ‚Ø§Ø¦ÙŠ</option>
    </select>
    <button onclick="startGame()">Ø§Ø¨Ø¯Ø£</button>
  </div>

  <select id="teamSelect">
    <option value="teamA">ğŸ”µ ÙØ±ÙŠÙ‚ Ø£</option>
    <option value="teamB">ğŸŸ¢ ÙØ±ÙŠÙ‚ Ø¨</option>
  </select>

  <div class="hint-box" id="hint">...</div>
  <div class="options" id="options"></div>
  <div id="feedback"></div>
  <div class="timer" id="timer"></div>
  <div class="score-board">
    Ù†Ù‚Ø§Ø· ÙØ±ÙŠÙ‚ Ø£: <span id="scoreA">0</span> | Ù†Ù‚Ø§Ø· ÙØ±ÙŠÙ‚ Ø¨: <span id="scoreB">0</span>
  </div>
  <div class="leaderboard" id="leaderboard"></div>

  <script>
    let allStudents = [], selectedStudents = [], questions = [];
    let currentIndex = 0;
    let scoreA = 0, scoreB = 0;
    let timerInterval, timeLeft = 15;

    async function loadStudentData() {
      const res = await fetch('https://raw.githubusercontent.com/A7mdooh/entertainment-app/main/data/studentData.json');
      const data = await res.json();
      const classSelect = document.getElementById("classSelect");
      classSelect.innerHTML = "<option disabled selected>Ø§Ø®ØªØ± Ø§Ù„ØµÙ</option>";
      for (const cls in data) {
        const opt = document.createElement("option");
        opt.value = cls;
        opt.textContent = `Ø§Ù„ØµÙ ${cls}`;
        classSelect.appendChild(opt);
      }
      return data;
    }

    async function startGame() {
      const data = await loadStudentData();
      const selectedClass = document.getElementById("classSelect").value;
      const mode = document.getElementById("modeSelect").value;
      if (!selectedClass || !mode) return alert("ÙŠØ±Ø¬Ù‰ Ø§Ø®ØªÙŠØ§Ø± Ø§Ù„ØµÙ ÙˆØ§Ù„Ù†Ù…Ø·");

      allStudents = data[selectedClass];
      if (mode === 'manual') {
        const selectionArea = document.createElement("div");
        selectionArea.id = "manualSelection";
        selectionArea.style.marginTop = "20px";
        selectionArea.innerHTML = '<h3>Ø§Ø®ØªØ± Ø§Ù„Ø·Ù„Ø§Ø¨ Ù„Ù„Ù…Ø´Ø§Ø±ÙƒØ©:</h3>';
        allStudents.forEach(name => {
          const card = document.createElement("div");
          card.textContent = name;
          card.className = "student-card";
          card.onclick = () => {
            card.classList.toggle("selected");
          };
          selectionArea.appendChild(card);
        });
        const confirmBtn = document.createElement("button");
        confirmBtn.textContent = "Ø¨Ø¯Ø¡ Ø§Ù„Ù†Ø´Ø§Ø·";
        confirmBtn.style.display = "block";
        confirmBtn.style.marginTop = "15px";
        confirmBtn.onclick = () => {
          selectedStudents = Array.from(selectionArea.querySelectorAll(".selected")).map(d => d.textContent);
          if (selectedStudents.length === 0) return alert("ÙŠØ±Ø¬Ù‰ Ø§Ø®ØªÙŠØ§Ø± Ø·Ø§Ù„Ø¨ ÙˆØ§Ø­Ø¯ Ø¹Ù„Ù‰ Ø§Ù„Ø£Ù‚Ù„");
          document.body.removeChild(selectionArea);
          generateQuestions();
        };
        selectionArea.appendChild(confirmBtn);
        document.body.appendChild(selectionArea);
        return;
      } else {
        selectedStudents = [...allStudents];
        generateQuestions();
      }
    }

    function generateQuestions() {
      const hintsBank = [
        "ÙŠØ³Ø§Ø¹Ø¯ Ø²Ù…Ù„Ø§Ø¡Ù‡ Ø¯Ø§Ø¦Ù…Ù‹Ø§.", "ÙŠØ´Ø§Ø±Ùƒ ÙÙŠ Ø¬Ù…ÙŠØ¹ Ø§Ù„Ø£Ù†Ø´Ø·Ø© Ø§Ù„ØµÙÙŠØ©.", "ÙŠØ­Ø¨ Ø§Ù„Ù‚Ø±Ø§Ø¡Ø© ÙƒØ«ÙŠØ±Ù‹Ø§.",
        "ÙŠØ¬Ù„Ø³ ÙÙŠ Ø§Ù„ØµÙ Ø§Ù„Ø£ÙˆÙ„.", "ÙŠØ±ØªØ¯ÙŠ Ù†Ø¸Ø§Ø±Ø§Øª Ø¬Ù…ÙŠÙ„Ø©.", "ÙŠØ¹Ø´Ù‚ Ù…Ø§Ø¯Ø© Ø§Ù„Ø¹Ù„ÙˆÙ….",
        "Ù‡Ø§Ø¯Ø¦ ÙˆÙ…Ø¤Ø¯Ø¨.", "ÙŠÙ‚ÙˆØ¯ ÙØ±ÙŠÙ‚Ù‡ Ø¯ÙˆÙ…Ù‹Ø§.", "ÙŠÙ…ØªÙ„Ùƒ Ø®Ø·Ù‹Ø§ Ø¬Ù…ÙŠÙ„Ù‹Ø§.",
        "ÙŠØ´Ø§Ø±Ùƒ ÙÙŠ Ø§Ù„Ø¥Ø°Ø§Ø¹Ø© Ø§Ù„Ù…Ø¯Ø±Ø³ÙŠØ©.", "ÙŠØªÙØ§Ø¹Ù„ ÙƒØ«ÙŠØ±Ù‹Ø§ Ù…Ø¹ Ø§Ù„Ù…Ø¹Ù„Ù….",
        "ÙŠØ´Ø¬Ø¹ Ø±ÙŠØ§Ù„ Ù…Ø¯Ø±ÙŠØ¯ ÙˆÙŠØ¸Ù† Ù†ÙØ³Ù‡ ÙÙŠÙ†ÙŠØ³ÙŠÙˆØ³!",
        "ÙŠØ±ØªØ¯ÙŠ Ù‚Ù…ÙŠØµ Ø¨Ø§Ø±ÙŠØ³ Ø³Ø§Ù† Ø¬ÙŠØ±Ù…Ø§Ù† ÙÙŠ ÙƒÙ„ Ø­ØµØ©!",
        "ÙƒÙ„ ØªÙ…Ø±ÙŠØ±Ø§ØªÙ‡ Ø¯Ù‚ÙŠÙ‚Ø© ÙƒØ£Ù†Ù‡ Ø¯ÙŠ Ø¨Ø±ÙˆÙŠÙ†!",
        "ÙŠØ­Ø¨ Ø§Ù„Ø±ÙŠØ§Ø¶Ø©ØŒ Ø®Ø§ØµØ© Ø§Ù„Ø¬Ø±ÙŠ Ù†Ø­Ùˆ Ø§Ù„ÙØ³Ø­Ø©!",
        "ÙŠÙØªØªØ­ ÙƒÙ„ ØµØ¨Ø§Ø­ Ø¨ØªØ­Ù„ÙŠÙ„ Ù…Ø¨Ø§Ø±ÙŠØ§Øª Ø§Ù„Ø£Ù…Ø³!",
        "Ø¥Ø°Ø§ Ø³Ù…Ø¹ ÙƒÙ„Ù…Ø© ÙØ³Ø­Ø©ØŒ ÙŠØªØ­ÙˆÙ„ Ø¥Ù„Ù‰ Ø¹Ø¯Ù‘Ø§Ø¡ Ù…Ø­ØªØ±Ù!",
        "ÙŠØ³Ø£Ù„ Ø£Ø³Ø¦Ù„Ø© Ù„Ø§ Ø¹Ù„Ø§Ù‚Ø© Ù„Ù‡Ø§ Ø¨Ø§Ù„Ø¯Ø±Ø³ ÙˆÙ„ÙƒÙ†Ù‡Ø§ Ù…Ù…ØªØ¹Ø©!",
        "Ø¯Ø§Ø¦Ù…Ù‹Ø§ Ù…Ø¨ØªØ³Ù….", "ÙŠØ·Ø±Ø­ Ø£Ø³Ø¦Ù„Ø© Ø°ÙƒÙŠØ© Ø¯Ø§Ø¦Ù…Ù‹Ø§."
      ];

      const shuffled = [...selectedStudents].sort(() => 0.5 - Math.random()).slice(0, 10);
      questions = shuffled.map(name => {
        const randomOptions = allStudents.filter(n => n !== name).sort(() => 0.5 - Math.random()).slice(0, 3);
        const options = [...randomOptions, name].sort(() => 0.5 - Math.random());
        const hint = hintsBank[Math.floor(Math.random() * hintsBank.length)];
        return { hint, answer: name, options };
      });

      loadQuestion();
    }

    function loadQuestion() {
      timeLeft = 15;
      startTimer();
      const q = questions[currentIndex];
      document.getElementById("hint").textContent = q.hint;
      const optionsBox = document.getElementById("options");
      optionsBox.innerHTML = '';
      q.options.forEach(opt => {
        const div = document.createElement("div");
        div.className = 'option';
        div.textContent = opt;
        div.onclick = () => selectAnswer(opt);
        optionsBox.appendChild(div);
      });
    }

    function startTimer() {
      clearInterval(timerInterval);
      document.getElementById("timer").textContent = `â³ Ø§Ù„ÙˆÙ‚Øª Ø§Ù„Ù…ØªØ¨Ù‚ÙŠ: ${timeLeft} Ø«Ø§Ù†ÙŠØ©`;
      timerInterval = setInterval(() => {
        timeLeft--;
        document.getElementById("timer").textContent = `â³ Ø§Ù„ÙˆÙ‚Øª Ø§Ù„Ù…ØªØ¨Ù‚ÙŠ: ${timeLeft} Ø«Ø§Ù†ÙŠØ©`;
        if (timeLeft <= 0) {
          clearInterval(timerInterval);
          selectAnswer(null);
        }
      }, 1000);
    }

    function selectAnswer(choice) {
      clearInterval(timerInterval);
      const correct = questions[currentIndex].answer;
      const feedback = document.getElementById("feedback");
      const team = document.getElementById("teamSelect").value;

      if (choice === correct) {
        feedback.textContent = "Ø¥Ø¬Ø§Ø¨Ø© ØµØ­ÙŠØ­Ø©! âœ¨";
        feedback.style.color = '#388e3c';
        confetti({ particleCount: 100, spread: 90 });
        if (team === 'teamA') {
          scoreA++; document.getElementById("scoreA").textContent = scoreA;
        } else {
          scoreB++; document.getElementById("scoreB").textContent = scoreB;
        }
      } else {
        feedback.textContent = "Ø®Ø·Ø£! Ø§Ù„Ø¥Ø¬Ø§Ø¨Ø© Ø§Ù„ØµØ­ÙŠØ­Ø© ÙƒØ§Ù†Øª: " + correct;
        feedback.style.color = '#c62828';
      }

      setTimeout(() => {
        feedback.textContent = "";
        currentIndex++;
        if (currentIndex < questions.length) {
          loadQuestion();
        } else {
          document.getElementById("hint").textContent = "âœ… Ø§Ù†ØªÙ‡Ù‰ Ø§Ù„Ù†Ø´Ø§Ø·!";
          document.getElementById("options").innerHTML = "";
          document.getElementById("timer").textContent = "";
          document.getElementById("leaderboard").innerHTML =
            `<strong>Ø§Ù„Ù†ØªÙŠØ¬Ø© Ø§Ù„Ù†Ù‡Ø§Ø¦ÙŠØ©:</strong><br>ğŸ”µ ÙØ±ÙŠÙ‚ Ø£: ${scoreA} Ù†Ù‚Ø·Ø©<br>ğŸŸ¢ ÙØ±ÙŠÙ‚ Ø¨: ${scoreB} Ù†Ù‚Ø·Ø©`;
        }
      }, 2000);
    }
  </script>
</body>
</html>
